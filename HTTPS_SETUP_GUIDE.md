# 🔐 HTTPS 設定指南 (iOS 必須)

## 為什麼需要 HTTPS？

### 🍎 **iOS 的嚴格要求**

iOS Safari 對 PWA 和相機功能有嚴格的安全性要求：

1. ❌ **Service Worker 需要 HTTPS**
   - HTTP 環境下完全無法使用 Service Worker
   - 即使是本地網路 (192.168.x.x) 也必須使用 HTTPS

2. ❌ **相機存取需要 HTTPS**
   - 條碼掃描功能需要存取相機
   - HTTP 環境下無法取得相機權限
   - 必須使用 HTTPS 才能使用條碼掃描

3. ❌ **PWA 安裝需要 HTTPS**
   - iOS 的 PWA 功能需要完整的 HTTPS 支援

### ✅ **Android 比較寬容**

Android Chrome 在開發環境較為寬容：
- ✅ localhost 可以使用 HTTP
- ✅ 本地網路可以使用 HTTP（但仍建議 HTTPS）

---

## 🚀 快速設定 HTTPS

### **步驟 1: 生成 SSL 憑證**

已經完成！您的憑證檔案：
- ✅ `cert.pem` - SSL 憑證
- ✅ `cert.key` - 私鑰
- ✅ 憑證有效期：1 年

### **步驟 2: 重新啟動 Flask**

1. 停止目前運行的 Flask 伺服器 (按 `Ctrl+C`)

2. 重新啟動：
   ```bash
   python app.py
   ```

3. 看到以下訊息表示成功：
   ```
   🔐 啟用 HTTPS 模式
   📱 iOS 裝置現在可以使用 Service Worker 和相機功能
   * Running on https://127.0.0.1:5000
   * Running on https://192.168.50.171:5000
   ```

---

## 📱 在手機上使用 HTTPS

### **重要：需要接受自簽名憑證警告**

因為我們使用的是自簽名憑證（不是由認證機構簽發），瀏覽器會顯示安全警告。這是正常的！

### **iOS Safari 接受憑證步驟：**

1. 在 Safari 開啟：
   ```
   https://192.168.50.171:5000
   ```

2. 會看到警告頁面：
   ```
   此連線並不是私人連線
   此網站可能會冒用「192.168.50.171」，您的資料可能會有風險
   ```

3. **點擊「顯示詳細資訊」**

4. **點擊「造訪此網站」**

5. 可能需要再次確認，點擊「造訪」

6. ✅ 完成！現在可以正常使用所有功能

### **Android Chrome 接受憑證步驟：**

1. 在 Chrome 開啟：
   ```
   https://192.168.50.171:5000
   ```

2. 會看到警告：
   ```
   您的連線不是私人連線
   ```

3. **點擊「進階」**

4. **點擊「繼續前往 192.168.50.171 (不安全)」**

5. ✅ 完成！

---

## 🎯 驗證 HTTPS 功能

### **訪問測試頁面：**

```
https://192.168.50.171:5000/pwa-test
```

現在應該會看到：
- ✅ Service Worker: 已註冊（iOS 也能看到！）
- ✅ 安全連線: HTTPS
- ✅ 可以安裝: 是

---

## 📷 測試條碼掃描

### **訪問零件查詢頁面：**

```
https://192.168.50.171:5000/part_lookup
```

現在點擊「📷 掃描條碼」按鈕：
- ✅ iOS: 會請求相機權限
- ✅ Android: 會請求相機權限
- ✅ 掃描功能正常運作

---

## 🔧 常見問題

### **Q1: 每次開啟都要接受憑證警告？**

**A:** 是的，自簽名憑證每次都需要接受。解決方法：

**iOS 方法（一勞永逸）:**
1. 將 `cert.pem` 傳送到 iPhone
2. 開啟檔案，安裝描述檔
3. 前往「設定」→「一般」→「關於本機」→「憑證信任設定」
4. 啟用完整信任

**更簡單的方法（建議）:**
- 接受一次警告後，在當前瀏覽器工作階段中不會再次提示
- 關閉瀏覽器後需要重新接受

### **Q2: 為什麼不能直接使用 HTTP？**

**A:** 這是 iOS 和現代瀏覽器的安全性政策：
- 相機、麥克風等敏感權限需要 HTTPS
- Service Worker 涉及快取和離線功能，需要 HTTPS
- PWA 需要完整的安全環境

### **Q3: 憑證過期怎麼辦？**

**A:** 憑證有效期 1 年，過期後重新執行：
```bash
python generate_ssl_cert.py
```

### **Q4: 可以在生產環境使用這個憑證嗎？**

**A:** ❌ 不可以！
- 這是**自簽名憑證**，僅供開發測試使用
- 生產環境需要使用正式的 SSL 憑證（Let's Encrypt、Cloudflare 等）

---

## 📊 功能對照表

| 功能 | HTTP (Android) | HTTP (iOS) | HTTPS (Android) | HTTPS (iOS) |
|------|----------------|------------|-----------------|-------------|
| 基本網頁瀏覽 | ✅ | ✅ | ✅ | ✅ |
| Service Worker | ✅ | ❌ | ✅ | ✅ |
| 條碼掃描 | ❌ | ❌ | ✅ | ✅ |
| PWA 安裝 | ✅ | ⚠️ 受限 | ✅ | ✅ |
| 離線支援 | ✅ | ❌ | ✅ | ✅ |
| 相機存取 | ❌ | ❌ | ✅ | ✅ |

---

## 🎉 完成檢查清單

設定完成後，請確認：

- [ ] 執行 `python generate_ssl_cert.py` ✅
- [ ] 看到 `cert.pem` 和 `cert.key` 檔案 ✅
- [ ] 重新啟動 Flask (看到 "🔐 啟用 HTTPS 模式") 
- [ ] 在手機開啟 `https://192.168.50.171:5000`
- [ ] 接受憑證警告
- [ ] 訪問 `/pwa-test` 確認 Service Worker 運作
- [ ] 訪問 `/part_lookup` 測試條碼掃描
- [ ] 安裝 PWA 到主畫面

---

## 🚀 現在開始！

1. **停止目前的 Flask 伺服器** (按 `Ctrl+C`)

2. **重新啟動應用程式：**
   ```bash
   python app.py
   ```

3. **在手機 Safari 開啟：**
   ```
   https://192.168.50.171:5000
   ```

4. **接受憑證警告**

5. **享受完整功能！** 🎊

---

## 💡 開發提示

### **切換回 HTTP（不建議）**

如果需要暫時切換回 HTTP：
```bash
# 重新命名憑證檔案
ren cert.pem cert.pem.backup
ren cert.key cert.key.backup

# 重新啟動 Flask
python app.py
```

### **恢復 HTTPS**

```bash
# 恢復憑證檔案
ren cert.pem.backup cert.pem
ren cert.key.backup cert.key

# 重新啟動 Flask
python app.py
```

---

現在您的應用程式已經完全支援 iOS 的所有功能了！🎉
